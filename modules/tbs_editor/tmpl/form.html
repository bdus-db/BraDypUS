<form id="form{{ uid }}" class="form-horizontal" action="javascript:void(0);">
	
	<div class="row">
		<div class="col-sm-5">
			<fieldset>
				<legend>General data</legend>
				
				<!-- NAME -->
				<div class="form-group">
					<label class="col-sm-3 control-label">Name *</label>
					<div class="col-sm-7">
						<input type="text" name="name" value="{{ data.name }}">
					</div>
				</div>
				
				<!-- LABEL -->
				<div class="form-group">
					<label class="col-sm-3 control-label">Label *</label>
					<div class="col-sm-7">
						<input type="text" name="label" value="{{ data.label }}">
					</div>
				</div>
				
				<!-- IS PLUGIN -->
				<div class="form-group">
					<label class="col-sm-3 control-label">Is plugin?</label>
					<div class="col-sm-7">
						<select name="is_plugin">
							<option{% if data.is_plugin == 0 %} selected="selected" {% endif %} value="">NO</option>
							<option{% if data.is_plugin == 1 %} selected="selected" {% endif %} value="1">YES</option>
						</select>
					</div>
				</div>
				
				<!-- ORDER -->
				<div class="form-group">
					<label class="col-sm-3 control-label">Order *</label>
					<div class="col-sm-7">
						<select name="order">
							<option></option>
							{% for id, label in fields %}
								<option value="{{ id }}"{% if id == data.order %} selected="selected" {% endif %}>{{ label }}</option>
							{% endfor %}
						</select>
					</div>
				</div>
				
				<!-- ID FIELD -->
				<div class="form-group">
					<label class="col-sm-3 control-label">ID field *</label>
					<div class="col-sm-7">
						<select name="id_field">
							<option></option>
							{% for id, label in fields %}
								<option value="{{ id }}"{% if id == data.id_field %} selected="selected" {% endif %}>{{ label }}</option>
							{% endfor %}
						</select>
					</div>
				</div>
				
				<!-- EDIT TEMPLATE -->
				<div class="form-group">
					<label class="col-sm-3 control-label">Edit template</label>
					<div class="col-sm-7">
						<select name="tmpl_edit">
							<option></option>
							{% for tmpl in templates %}
								<option value="{{ id }}"{% if tmpl == data.tmpl_edit %} selected="selected" {% endif %}>{{ tmpl }}</option>
							{% endfor %}
						</select>
					</div>
				</div>
				
				<!-- READ TEMPLATE -->
				<div class="form-group">
					<label class="col-sm-3 control-label">Read template</label>
					<div class="col-sm-7">
						<select name="tmpl_read">
							<option></option>
							{% for tmpl in templates %}
								<option value="{{ id }}"{% if tmpl == data.tmpl_read %} selected="selected" {% endif %}>{{ tmpl }}</option>
							{% endfor %}
						</select>
					</div>
				</div>
				
				<!-- RS -->
				<div class="form-group">
					<label class="col-sm-3 control-label">RS</label>
					<div class="col-sm-7">
						<select name="rs">
							<option></option>
							{% for id, label in fields %}
								<option value="{{ id }}"{% if id == data.rs %} selected="selected" {% endif %}>{{ label }}</option>
							{% endfor %}
						</select>
					</div>
				</div>
				
				<!-- PREVIEW -->
				<div class="form-group">
					<label class="col-sm-3 control-label">Preview</label>
					<div class="col-sm-7">
						{% for preview in data.preview %}
							<select name="preview[]"{% if loop.index0 == 0 %} class="cloneable"{% endif %}>
								<option></option>
								{% for id, label in fields %}
									<option value="{{ id }}"{% if id == preview %} selected="selected" {% endif %}>{{ label }}</option>
								{% endfor %}
							</select>
						{% endfor %}
						<button type="button" class="btn btn-default clone-action" data-baseName="aaa">+</button>
					</div>
				</div>
				
				<!-- PLUGINS -->
				<div class="form-group">
					<label class="col-sm-3 control-label">Plugins</label>
					<div class="col-sm-7">
						{% for plugin in data.plugin %}
							<select name="plugin[]"{% if loop.index0 == 0 %} class="cloneable"{% endif %}>
								<option></option>
								{% for id, plg in available_plugins %}
									<option value="{{ id }}"{% if id == plugin %} selected="selected" {% endif %}>{{ plg }}</option>
								{% endfor %}
							</select>
						{% endfor %}
						<button type="button" class="btn btn-default clone-action"  data-baseName="aaa">+</button>
					</div>
				</div>
			</fieldset>	
		</div>
			
			
		<div class="col-sm-7">
			
			<!-- LINKS -->
			<fieldset>
				<legend>Links</legend>
					{% for link_arr in data.link %}
						{% set index = loop.index0 %}
						<fieldset{% if index == 0 %} class="cloneable"{% endif %} style="margin:20px 0;">
							<div class="row">
								<div class="col-sm-4">
									<label>Other table's name</label>
									<select name="link[aaa{{ index }}][other_tb]">
										<option></option>
										{% for id, label in available_tables %}
											<option value="{{ id }}"{% if id == link_arr.other_tb %} selected="selected" {% endif %}>{{ label }}</option>
										{% endfor %}
									</select>
								</div>
								
								<div class="col-sm-8">
									{% for fld_arr in link_arr.fld %}
										<div class="row cloneable">
											<div class="col-sm-6">
												<label>This table's field</label>
												<select name="link[aaa{{ index }}][fld][bbb{{ loop.index0 }}][my]">
													<option></option>
													{% for id, label in fields %}
														<option value="{{ id }}"{% if id == fld_arr.my %} selected="selected" {% endif %}>{{ label }}</option>
													{% endfor %}
												</select>
											</div>
											<div class="col-sm-6">
												<label>Other table's field</label>
												<input name="link[aaa{{ index }}][fld][bbb{{ loop.index0 }}][other]" value="{{ fld_arr.other }}" />
											</div>
										</div>
										<button type="button" class="btn btn-default clone-action"  data-baseName="bbb">+</button>
									{% endfor %}
								</div>
								
							</div>
						</fieldset>
					{% endfor %}
					<button type="button" class="btn btn-default clone-action"  data-baseName="aaa">+</button>
				
			</fieldset>
			
			
			<!-- GEOFACE -->
			<fieldset>
				<legend>Geoface</legend>
				
				<div class="row">
					<div class="col-sm-6">
						<label>Map EPSG</label>
						<select name="geoface[epsg]">
							<option></option>
							{% for id, label in available_epsgs %}
								<option value="{{ id }}"{% if id == data.geoface.epsg %} selected="selected" {% endif %}>{{ label }}</option>
							{% endfor %}
						</select>
					</div>
					
					<div class="col-sm-6">
						<label>Exclude web basemaps</label>
						{% for excl in data.geoface.layers.excludeWeb %}
							<select name="geoface[layers][excludeWeb][]" {% if loop.index0 == 0 %} class="cloneable"{% endif %}>
								<option></option>
								<option value="google"{% if data.geoface.excludeWeb == 'google' %} selected="selected" {% endif %}>Google</option>
								<option value="osm"{% if data.geoface.excludeWeb == 'osm' %} selected="selected" {% endif %}>Open Street Map</option>
								
							</select>
						{% endfor %}
						<button type="button" class="btn btn-default clone-action" data-baseName="aaa">+</button>
					</div>
				</div>
					
				
				<label>Locally provided layers</label>
				{% for layer in data.geoface.layers.local %}
					<fieldset{% if loop.index0 == 0 %} class="cloneable"{% endif %} style="margin:30px 0;">
						<div class="row">
							<div class="col-sm-6 col-sm-offset-1">
								<label>Name</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][name]" value="{{ layer.name }}" />
								
								<label>ID</label>
								<select name="geoface[layers][local][aaa{{ loop.index0 }}][id]">
									<option></option>
									{% for id in available_geoface_layers %}
										<option value="{{ id }}"{% if id == layer.id %} selected="selected" {% endif %}>{{ id }}</option>
									{% endfor %}
								</select>
								
								<label>EPSG</label>
								<select name="geoface[layers][local][aaa{{ loop.index0 }}][epsg]">
									<option></option>
									{% for id, label in available_epsgs %}
										<option value="{{ id }}"{% if id == layer.epsg %} selected="selected" {% endif %}>{{ label }}</option>
									{% endfor %}
								</select>
								
								<label>pointRadius</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][pointRadius]" value="{{ layer.style.pointRadius }}" />
								
								<label>fillColor</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][fillColor]" value="{{ layer.style.fillColor }}" />
								
								<label>strokeColor</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][strokeColor]" value="{{ layer.style.strokeColor }}" />
								
								<label>label</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][label]" value="{{ layer.style.label }}" />
								
								
							</div>
							
							<div class="col-sm-5">
							
								<label>labelAlign</label>
								<select name="geoface[layers][local][aaa{{ loop.index0 }}][style][labelAlign]">
									<option></option>
									<option{% if layer.style.labelAlign == 'lb' %} selected="selected" {% endif %}>lb</option>
									<option{% if layer.style.labelAlign == 'lt' %} selected="selected" {% endif %}>lt</option>
									<option{% if layer.style.labelAlign == 'rb' %} selected="selected" {% endif %}>rb</option>
									<option{% if layer.style.labelAlign == 'rt' %} selected="selected" {% endif %}>rt</option>
								</select>
								
								
								<label>labelXOffset</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][labelXOffset]" value="{{ layer.style.labelXOffset }}" />
								
								<label>fontSize</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][fontSize]" value="{{ layer.style.fontSize }}" />
								
								<label>fontFamily</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][fontFamily]" value="{{ layer.style.fontFamily }}" />
								
								<label>fontColor</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][fontColor]" value="{{ layer.style.fontColor }}" />
								
								<label>labelOutlineColor</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][labelOutlineColor]" value="{{ layer.style.labelOutlineColor }}" />
								
								<label>labelOutlineWidth</label>
								<input name="geoface[layers][local][aaa{{ loop.index0 }}][style][labelOutlineWidth]" value="{{ layer.style.labelOutlineWidth }}" />
								
							</div>
						</div>
					</fieldset>
				{% endfor %}
				<button type="button" class="btn btn-default clone-action" data-baseName="aaa">+</button>
				
				
				</fieldset>
			</div>
		</div>
		
	
	<button type="submit" class="btn btn-success"><i class="glyphicon glyphicon-floppy-disk"></i> {{ tr.get('save') }}</button>
</form>

	 
<script>
	
	$('#form{{ uid }} button.clone-action').on('click', function(){
		
		var baseName = $(this).data('basename')
		
		if ($(this).prev('div.where').length < 1){
			var where = $('<div />').addClass('where').insertBefore($(this));
		} else {
			var where = $(this).prev('div.where');
		}
		utils.myClone($(this).prevAll('.cloneable'), {
			where: where,
			baseName: baseName,
			preserveEnhance: false,
			cloneEvents: true
		});
	});
	
	$('#form{{uid}} button.toggleFieldset').on('click', function(){
		$(this).next('fieldset').toggle();
	});
	
	$('#form{{ uid }}').on('submit', function(){
		tbs_editor.saveData($(this), '{{ tb }}');
	});
</script>	 
	
