/**
 * @author			Julian Bogdani <jbogdani@gmail.com>
 * @copyright		BraDypUS, Julian Bogdani <jbogdani@gmail.com>
 * @license			See file LICENSE distributed with this code
 */
var rs={init:function(){$.each($("div.showRS"),(function(e,t){rs._show($(t))}))},_deleteRS:function(e,t){core.getJSON("rs_ctrl","deleteRS",{id:e},!1,(function(e){core.message(e.text,e.status),"success"===e.status&&t.remove()}))},_addRS:function(e,t,d,n,a){core.getJSON("rs_ctrl","saveNewRS",{tb:e,first:t,relation:d,second:n},!1,(function(e){core.message(e.text,e.status),"success"===e.status&&(a.find("input.second").val(""),a.find("td.r"+d).append($("<div />").append(n," ",$("<span />").attr({"data-id":e.id,title:core.tr("erase")}).addClass("delete_js a").text("[x]").click((function(){rs._deleteRS(e.id,$(this).parent("div"))})))))}))},_show:function(e){if(0===e.length)return!1;var t=e.data("table"),d=encodeURI(e.data("id")),n=e.data("context");return!!(t&&d&&n)&&(!(e.children().length>0)&&(!0!==e.data("pending")&&!0!==e.data("done")&&(e.data("pending",!0),void e.load("./?obj=rs_ctrl&method=getAllRS&tb="+t+"&id="+d+"&context="+n,(function(){e.data("done",!0),e.data("pending",!1),"read"===n?e.find("div.rsEl").on("click",(function(){api.record.read(t,[$(this).text()],!0)})):"edit"===n&&e.find("button.save").click((function(){var n=e.find("select.rel").val(),a=e.find("input.second").val();a?rs._addRS(t,d,n,a,e):core.message(core.tr("rs_all_fields_required"),"error")})),e.find("a.delete").click((function(){rs._deleteRS($(this).data("id"),$(this).parent("div"))}))})))))}};