<h3>{{ records_found }}</h3>

{% if noOpts == false %}
<div style="margin:10px 0; padding:10px;" class="btn-group">

		<!-- READ -->
	{% if can_user_read %}
	<a onclick="api.record.actOn('read', '{{ tb }}', dt{{ tb }}{{ uid }});" title="{{ tr.get('read') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-eye-open"></i>
	</a>
	{% endif %}

	<!-- EDIT -->
	{% if can_user_edit %}
	<a onclick="api.record.actOn('edit', '{{ tb }}', dt{{ tb }}{{ uid }});" title="{{ tr.get('edit') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-pencil"></i>
	</a>
	
	<!-- ERASE -->
	<a onclick="api.record.actOn('erase', '{{ tb }}', dt{{ tb }}{{ uid }});" title="{{ tr.get('erase') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-trash"></i>
	</a>
	
	<!-- CHECK/UNCHECK ALL -->
	<a onclick="api.record.toogleSelect('list_{{ tb }}{{ uid }}');" title="{{ tr.get('toggle_select_all') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-flag"></i>
	</a>
	
	{% endif %}

	{% if can_user_add %}
	<!-- ADD NEW -->
	<a onclick="api.record.actOn('add', '{{ tb }}');" title="{{ tr.get('add') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-file"></i>
	</a>
	{% endif %}
	
	<!-- SHOW QUERY -->
	<a onclick="api.query.show('{{ urlencoded_query }}');" title="{{ tr.get('show_query_text') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-info-sign"></i>
	</a>
	
	<!-- SAVE QUERY -->
	<a onclick="api.query.save('{{ encoded_where }}', '{{ tb }}');" title="{{ tr.get('save_query_as') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-bookmark"></i>
	</a>
	
	<!-- RELOAD BUTTON -->
	<a onclick="dt{{ tb }}{{ uid }}.fnDraw();" title="{{ tr.get('reload_query') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-repeat"></i>
	</a>
	
	{% if noResult == false %}
	
	<!-- EXPORT QUERY BUTTON  -->
	<a onclick="api.query.Export('{{ encoded_where }}', '{{ tb }}');" title="{{ tr.get('export_query') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-random"></i>
	</a>
	
	<!-- MATRIX -->
	{% if hasRS %}
	<a onclick="api.record.showMatrix('{{ tb }}', '{{ encoded_where }}');" title="{{ tr.get('harris_matrix') }}" class="btn btn-default">
		<i class="icon-sitemap"></i>
	</a>
	{% endif %}
	
	<!-- BUILD CHART -->
	<a onclick="core.runMod('chart', ['{{ tb }}', '{{ encoded_where }}']);" title="{{ tr.get('build_chart') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-align-left"></i>
	</a>
	
	<!-- MAP -->
	<a onclick="core.runMod('geoface', ['{{ tb }}', '{{ encoded_where }}']);" title="{{ tr.get('view_on_map') }}" class="btn btn-default">
		<i class="glyphicon glyphicon-map-marker"></i>
	</a>
	
	<!-- PRINT -->
	<a title="{{ tr.get('print') }}" class="btn btn-default print-results">
		<i class="glyphicon glyphicon-print"></i>
	</a>
	
	{% endif %}
</div>
{% else %}
{% endif %}

{% if noResult == false %}
<div class="id-holder" data-id="{{ tb }}{{ uid }}"></div>
<table id="list_{{ tb }}{{ uid }}" class="results  table table-striped table-bordered table-condensed" style="width:100%">
	<thead>
		<tr>
		{% for col_name in col_names %}
			<th>{{ col_name }}</th>
		{% endfor %}
		</tr>
	</thead>
	<tbody></tbody>
</table>
<script>
	
	var dt{{ tb }}{{ uid }} = $('#list_{{ tb }}{{ uid }}').dataTable({
		"aaSorting": [],
		{% if infinte_scroll %}
		"bScrollInfinite": true,
        "bScrollCollapse": true,
        "sScrollY": "400px",
        {% endif %}
		{% if lang %}
		"oLanguage": {
			"sUrl": "./js/datatable-i18n/{{ lang }}.txt"
			},
		{% endif %}
		"iDisplayLength": 30,
		"bProcessing": true,
        "bServerSide": true,
        "sAjaxSource": "./controller.php?test=1&obj=record_ctrl&method=sql2json&tb={{ tb }}&iTotalRecords={{ iTotalRecords }}",
        		{# &q_encoded={{ encoded_query }}', #}
        "sServerMethod": "POST",
        "fnServerParams": function ( aoData ) {
            aoData.push({
            	name: "q_encoded",
            	value:"{{ encoded_query }}"
            });
        },
        "fnRowCallback": function (nRow, aData, iDisplayIndex) {
            $(nRow).on("click", function (event) {
            	$(this).toggleClass('row_selected');
            });

            {% if noDblClick == false %}
            $(nRow).on("dblclick", function(){
            	var id = $(nRow).find('td:first').html();
            	api.record.read('{{ tb }}', [id]);
            });
            {% endif %}
        },
        "aoColumns": [
                      {% for col_id, col_name in col_names %}
                      {"mData":"{{ col_id }}"},
                      {% endfor %}
                  ]
	});

	
	
	
	$('a.print-results').on('click', function(){
		$('#list_{{ tb }}{{ uid }}').printElement({
			  printMode:'popup',
			  leaveOpen:true,
			  pageTitle: 'BraDypUS > {{ tb}}',
			  printBodyOptions:{
				  styleToAdd:'background: #fff;color:#000;padding:10px;margin:10px;'
			  }
		  });
	});
	
</script>
{% endif %}
