<div id="{{ uid }}">
	<input type="hidden" name="query_text" value="{{ data.encoded_query }}" class="query_text" />
 
	<div class="chart" style="max-width:1000px;"></div>
	
	<p>
		<button class="btn btn-default download"><i class="glyphicon glyphicon-download"></i> {{ tr.get('download_img') }}</button>
		<button class="btn btn-default save_as"><i class="glyphicon glyphicon-save"></i> {{ tr.get('save_chart_as') }}</button>
	</p>
</div>

<script>

	$('#{{ uid }} button.download').on('click', function(){
		 var img = $('#{{ uid }} div.jqplot-target').jqplotToImage(50, 0);
		 if (img) {
			 window.open(img.toDataURL("image/png"));
		 } 
	});
	
	$('#{{ uid }} button.save_as').on('click', function(){
		chart.saveAs($('#{{ uid }} input.query_text').val());
	});
	
	var plot = $.jqplot('{{ uid }} div.chart', {{ data.json_data|raw }}, {
		seriesDefaults:{
			renderer:$.jqplot.BarRenderer,
			pointLabels: { show: true },
			rendererOptions: {fillToZero: true}
		},
		legend: {
			show: true,
			//location: 'ne',
			//xoffset: -115,
			placement: 'outsideGrid'
		},
		series: {{ data.json_series|raw }},
		axes: {
			xaxis: {
				renderer: $.jqplot.CategoryAxisRenderer,
				ticks: {{ data.json_ticks|raw }}
			},
			yaxis: {
				pad: 1.05
			}
		}
	});
</script>
