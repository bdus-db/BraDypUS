/**
 * @author			Julian Bogdani <jbogdani@gmail.com>
 * @copyright		BraDypUS, Julian Bogdani <jbogdani@gmail.com>
 * @license			See file LICENSE distributed with this code
 */
var free_sql={init:function(){free_sql.show_form()},show_form:function(){core.open({obj:"free_sql_ctrl",method:"input",title:"Run free SQL query",loaded:function(){api.fileUpload($("#modal .upload"),"./?obj=file_ctrl&method=upload",{limit2one:!0,limitExtensions:["sql","gz"],complete:function(e,t,o){var s=$("#modal .status");s.show(),s.find(".progress").show(),s.find(".bar").width("0%"),s.find(".verbose").html(""),free_sql.restoreSQL(s,o.uploadDir+""+o.filename+"."+o.ext)}})},buttons:[{text:"Run",click:function(){var e=$("#modal textarea").val();e?core.getJSON("free_sql_ctrl","run",!1,{sql:e},(function(e){$("#modal .status").show(),$("#modal .progress").hide(),$("#modal .verbose").html('<p class="text-'+e.status+'">'+e.text+"</p>")})):(core.message("Query text can not be empty","error"),$("#modal textarea").focus())}},{text:"Close",click:"close"}]},"modal")},restoreSQL:function(e,t,o,s,r){core.getJSON("free_sql_ctrl","import",{filename:t,start:o,offset:s,totalqueries:r},!1,(function(o){"loading"==o.status?(e.find(".bar").width(o.percent_done+"%"),e.find(".verbose").html('<p class="text-info">'+percent_done+"%"+core.loading+"</p>"),free_sql.restoreSQL(e,escape(t),o.lines_done+1,o.bytes_done,o.queries_done)):"completed"==o.status?(e.find(".bar").width("100%"),e.find(".verbose").html('<p class="text-success">Congrats! Upload finished<br />'+o.queries_done+" queries executed<br />"+o.bytes_done/1024+" bytes processed!</p>")):"error"==o.status&&e.find(".verbose").html('<p class="text-error">'+o.text+"</p>")}))}};